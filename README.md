# Q_System - é‡åŒ–äº¤æ˜“å…¨æ ˆåŸ¹è®­ç³»ç»Ÿ

åŸºäº XtQuantï¼ˆå›½é‡‘è¯åˆ¸ QMTï¼‰çš„é‡åŒ–äº¤æ˜“å›æµ‹ä¸å®ç›˜æ¡†æ¶ã€‚é‡‡ç”¨ç­–ç•¥-å¼•æ“åˆ†ç¦»æ¶æ„ï¼Œæ”¯æŒè‡ªå®šä¹‰ç­–ç•¥çš„å›æµ‹éªŒè¯ä¸å®ç›˜äº¤æ˜“ã€‚

æœ¬é¡¹ç›®æ˜¯120å¤©é‡åŒ–äº¤æ˜“åŸ¹è®­è®¡åˆ’çš„å®è·µå¹³å°ï¼Œæ¶µç›–ä»æ•°æ®å·¥ç¨‹åˆ°ç­–ç•¥å¼€å‘çš„å®Œæ•´æŠ€æœ¯æ ˆã€‚

## ğŸš€ å¿«é€Ÿå¯¼èˆª

**æ–°æ‰‹å…¥é—¨ï¼Ÿ** è¯·ä»è¿™é‡Œå¼€å§‹ï¼š

- ğŸ“– [**å­¦ä¹ è·¯å¾„å¯¼èˆª**](docs/guides/STUDY_PATH.md) - å®Œæ•´çš„ä¸¤å‘¨å­¦ä¹ è·¯çº¿å›¾
- ğŸ“š [**å®Œæ•´å­¦ä¹ æŒ‡å—**](docs/guides/LEARNING_GUIDE.md) - è¯¦ç»†çš„æ¯æ—¥å­¦ä¹ è®¡åˆ’
- âš¡ [**å¿«é€Ÿå‚è€ƒæ‰‹å†Œ**](docs/guides/QUICK_REFERENCE.md) - å¸¸ç”¨å‘½ä»¤å’Œä»£ç é€ŸæŸ¥

**å·²ç»ç†Ÿæ‚‰é¡¹ç›®ï¼Ÿ** å¿«é€Ÿè·³è½¬ï¼š

- [ç¯å¢ƒé…ç½®](#ç¯å¢ƒé…ç½®)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [APIæ–‡æ¡£](#apiæ–‡æ¡£)

## å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬é¡¹ç›®ï¼Œä½ å°†æŒæ¡ï¼š

1. **é‡‘èæ•°æ®å·¥ç¨‹** (Week 2)
   - XtData APIé›†æˆä¸å¸‚åœºæ•°æ®è·å–
   - ä»·æ ¼å¤æƒæœºåˆ¶ï¼ˆå‰å¤æƒ/åå¤æƒï¼‰
   - åŸºæœ¬é¢æ•°æ®ETLä¸æ—¶é—´ç‚¹æ­£ç¡®æ€§
   - è¡Œä¸šåˆ†ç±»ç®¡ç†ä¸æ¿å—åˆ†æ
   - æ•°æ®æŒä¹…åŒ–ä¸å¢é‡æ›´æ–°
   - é‡‘èæ•°æ®å¯è§†åŒ–
   - æœªæ¥å‡½æ•°é˜²èŒƒä¸å›æµ‹çœŸå®æ€§

2. **é‡åŒ–ç­–ç•¥å¼€å‘** (Week 3+)
   - ç­–ç•¥-å¼•æ“åˆ†ç¦»æ¶æ„
   - å›æµ‹ä¸å®ç›˜ç»Ÿä¸€æ¥å£
   - é£é™©æ§åˆ¶ä¸èµ„é‡‘ç®¡ç†
   - ç­–ç•¥æ€§èƒ½è¯„ä¼°

3. **ç”Ÿäº§çº§ç³»ç»Ÿè®¾è®¡**
   - æ¨¡å—åŒ–æ¶æ„è®¾è®¡
   - é”™è¯¯å¤„ç†ä¸æ—¥å¿—ç®¡ç†
   - æ•°æ®è´¨é‡æ£€æŸ¥
   - æ€§èƒ½ä¼˜åŒ–ä¸æ‰©å±•æ€§

## åŠŸèƒ½ç‰¹æ€§

### æ•°æ®å·¥ç¨‹æ¨¡å— (Week 2)

- **XtData APIé›†æˆ**: å°è£…XtDataæ¥å£ï¼Œæ”¯æŒå†å²æ•°æ®å’Œå®æ—¶æ•°æ®è·å–
- **ä»·æ ¼å¤æƒå¤„ç†**: å®ç°å‰å¤æƒå’Œåå¤æƒç®—æ³•ï¼Œç¡®ä¿å›æµ‹å‡†ç¡®æ€§
- **åŸºæœ¬é¢æ•°æ®ETL**: å¤„ç†è´¢åŠ¡æŒ‡æ ‡ï¼ˆPEã€PBã€ROEï¼‰ï¼Œä¸¥æ ¼æ—¶é—´ç‚¹æ­£ç¡®æ€§
- **è¡Œä¸šåˆ†ç±»ç®¡ç†**: æ”¯æŒç”³ä¸‡è¡Œä¸šåˆ†ç±»æŸ¥è¯¢å’Œå†å²å˜æ›´è¿½è¸ª
- **æ•°æ®æŒä¹…åŒ–**: HDF5é«˜æ•ˆå­˜å‚¨ï¼Œæ”¯æŒå¢é‡æ›´æ–°å’ŒCSVå¯¼å‡º
- **æ•°æ®å¯è§†åŒ–**: Kçº¿å›¾ã€æˆäº¤é‡ã€æŠ€æœ¯æŒ‡æ ‡å¯è§†åŒ–
- **æ•°æ®è´¨é‡æ£€æŸ¥**: å¼‚å¸¸å€¼æ£€æµ‹ã€ç¼ºå£è¯†åˆ«ã€å®Œæ•´æ€§éªŒè¯

### äº¤æ˜“ç³»ç»Ÿæ¨¡å—

- **ç­–ç•¥-å¼•æ“åˆ†ç¦»**: ç­–ç•¥é€»è¾‘ä¸æ‰§è¡Œå¼•æ“è§£è€¦ï¼Œä¾¿äºç­–ç•¥å¤ç”¨ä¸æµ‹è¯•
- **åŒæ¨¡å¼è¿è¡Œ**: æ”¯æŒå›æµ‹æ¨¡å¼ (`BacktestEngine`) å’Œå®ç›˜æ¨¡å¼ (`LiveRunner`)
- **å®‰å…¨æœºåˆ¶**: å†…ç½®è¿è¡Œæ¨¡å¼é” + äººå·¥ç¡®è®¤é˜²ç«å¢™ï¼Œé˜²æ­¢è¯¯æ“ä½œ
- **ç»Ÿä¸€æ¥å£**: ç­–ç•¥é€šè¿‡ `Context` å¯¹è±¡ä¸å¼•æ“äº¤äº’ï¼Œå›æµ‹ä¸å®ç›˜ä»£ç ä¸€è‡´

## é¡¹ç›®ç»“æ„

```plaintext
Q_System/
â”œâ”€â”€ main.py              # å›æµ‹å¯åŠ¨è„šæœ¬
â”œâ”€â”€ run_live.py          # å®ç›˜å¯åŠ¨è„šæœ¬
â”œâ”€â”€ config.py            # é…ç½®æ–‡ä»¶ï¼ˆAPIå¯†é’¥ã€å­˜å‚¨è·¯å¾„ï¼‰
â”œâ”€â”€ requirements.txt     # ç”Ÿäº§ä¾èµ–
â”œâ”€â”€ requirements-dev.txt # å¼€å‘ä¾èµ–
â”œâ”€â”€ environment.yml      # Conda ç¯å¢ƒé…ç½®
â”‚
â”œâ”€â”€ core/                # æ ¸å¿ƒå¼•æ“æ¨¡å—
â”‚   â”œâ”€â”€ README.md            # æ¨¡å—è¯´æ˜
â”‚   â”œâ”€â”€ engine.py            # å›æµ‹å¼•æ“
â”‚   â”œâ”€â”€ live_runner.py       # å®ç›˜å¼•æ“
â”‚   â”œâ”€â”€ strategy.py          # ç­–ç•¥åŸºç±»
â”‚   â””â”€â”€ context.py           # ä¸Šä¸‹æ–‡å¯¹è±¡ (æ ¸å¿ƒäº¤äº’æ¥å£)
â”‚
â”œâ”€â”€ src/                 # æ•°æ®å·¥ç¨‹æ¨¡å—
â”‚   â”œâ”€â”€ README.md            # æ¨¡å—è¯´æ˜
â”‚   â”œâ”€â”€ xtdata_client.py     # XtData APIå®¢æˆ·ç«¯å°è£…
â”‚   â”œâ”€â”€ data_retriever.py    # æ•°æ®è·å–å™¨
â”‚   â”œâ”€â”€ price_adjuster.py    # ä»·æ ¼å¤æƒå¤„ç†å™¨
â”‚   â”œâ”€â”€ fundamental_handler.py # åŸºæœ¬é¢æ•°æ®å¤„ç†å™¨
â”‚   â”œâ”€â”€ industry_mapper.py   # è¡Œä¸šåˆ†ç±»æ˜ å°„å™¨
â”‚   â”œâ”€â”€ data_manager.py      # æ•°æ®æŒä¹…åŒ–ç®¡ç†å™¨
â”‚   â”œâ”€â”€ visualizer.py        # é‡‘èæ•°æ®å¯è§†åŒ–å™¨
â”‚   â”œâ”€â”€ data_alignment.py    # æ•°æ®å¯¹é½å·¥å…·
â”‚   â””â”€â”€ full_market_downloader.py  # å…¨å¸‚åœºæ•°æ®ä¸‹è½½
â”‚
â”œâ”€â”€ strategies/          # ç­–ç•¥å®ç°
â”‚   â”œâ”€â”€ README.md            # ç­–ç•¥å¼€å‘æŒ‡å—
â”‚   â””â”€â”€ double_ma.py         # åŒå‡çº¿ç­–ç•¥ç¤ºä¾‹
â”‚
â”œâ”€â”€ examples/            # ç¤ºä¾‹è„šæœ¬
â”‚   â”œâ”€â”€ README.md            # ç¤ºä¾‹è¯´æ˜æ–‡æ¡£
â”‚   â”œâ”€â”€ 01_basic_data_retrieval.py
â”‚   â”œâ”€â”€ 02_price_adjustment.py
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ exercises/           # å­¦ä¹ ç»ƒä¹ 
â”‚   â”œâ”€â”€ README.md            # ç»ƒä¹ è¯´æ˜
â”‚   â”œâ”€â”€ week1/               # ç¬¬ä¸€å‘¨ï¼šPythonåŸºç¡€
â”‚   â””â”€â”€ week2/               # ç¬¬äºŒå‘¨ï¼šæ•°æ®å·¥ç¨‹
â”‚
â”œâ”€â”€ tests/               # æµ‹è¯•å¥—ä»¶
â”‚   â”œâ”€â”€ README.md            # æµ‹è¯•è¯´æ˜
â”‚   â”œâ”€â”€ conftest.py          # pytest é…ç½®
â”‚   â”œâ”€â”€ unit/                # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ property/            # å±æ€§æµ‹è¯•
â”‚   â””â”€â”€ integration/         # é›†æˆæµ‹è¯•
â”‚
â”œâ”€â”€ data/                # æœ¬åœ°æ•°æ®å­˜å‚¨
â”‚   â”œâ”€â”€ README.md            # æ•°æ®ç›®å½•è¯´æ˜
â”‚   â”œâ”€â”€ market_data.h5       # HDF5æ•°æ®åº“
â”‚   â”œâ”€â”€ cache/               # ç¼“å­˜ç›®å½•
â”‚   â””â”€â”€ csv_exports/         # CSVå¯¼å‡ºæ–‡ä»¶
â”‚
â”œâ”€â”€ logs/                # æ—¥å¿—æ–‡ä»¶
â”‚
â”œâ”€â”€ scripts/             # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ README.md            # è„šæœ¬è¯´æ˜
â”‚   â”œâ”€â”€ setup/               # ç¯å¢ƒé…ç½®è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ setup_env.bat
â”‚   â”‚   â”œâ”€â”€ setup_env.ps1
â”‚   â”‚   â”œâ”€â”€ scripts\setup\start_isolated.bat
â”‚   â”‚   â””â”€â”€ start_isolated.ps1
â”‚   â”œâ”€â”€ verify/              # éªŒè¯è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ check_env.py
â”‚   â”‚   â””â”€â”€ verify_week2_setup.py
â”‚   â””â”€â”€ utils/               # å·¥å…·è„šæœ¬
â”‚       â”œâ”€â”€ scripts\utils\check.bat
â”‚       â””â”€â”€ git_commit_all.bat
â”‚
â””â”€â”€ docs/                # æ–‡æ¡£
    â”œâ”€â”€ README.md            # æ–‡æ¡£ç›®å½•è¯´æ˜
    â”œâ”€â”€ guides/              # ç”¨æˆ·æŒ‡å—
    â”‚   â”œâ”€â”€ LEARNING_GUIDE.md
    â”‚   â”œâ”€â”€ QUICK_REFERENCE.md
    â”‚   â”œâ”€â”€ SETUP_GUIDE.md
    â”‚   â””â”€â”€ STUDY_PATH.md
    â”œâ”€â”€ api/                 # API æ–‡æ¡£
    â”‚   â”œâ”€â”€ xtdata.md
    â”‚   â””â”€â”€ xttrader.md
    â”œâ”€â”€ plans/               # è®¡åˆ’æ–‡æ¡£
    â”‚   â””â”€â”€ plan.md
    â”œâ”€â”€ reports/             # ä»»åŠ¡éªŒè¯æŠ¥å‘Š
    â”‚   â””â”€â”€ TASK_*.md
    â””â”€â”€ notes/               # å­¦ä¹ ç¬”è®°
        â””â”€â”€ week1_*.md
```

## ç¯å¢ƒé…ç½®

### ç³»ç»Ÿè¦æ±‚

| é¡¹ç›® | è¦æ±‚ |
| ------ | ------ |
| Python | **3.8.x** (miniQMT ç¡¬æ€§è¦æ±‚) |
| æ“ä½œç³»ç»Ÿ | Windows (QMT ä»…æ”¯æŒ Windows) |
| Conda | æ¨èä½¿ç”¨ Miniconda |
| QMT | å›½é‡‘è¯åˆ¸ MiniQMT å®¢æˆ·ç«¯ |

### æ ¸å¿ƒä¾èµ–

| åŒ…å | ç‰ˆæœ¬ | è¯´æ˜ |
| ------ | ------ | ------ |
| xtquant | 250516+ | å›½é‡‘è¯åˆ¸ QMT äº¤æ˜“æ¥å£ |
| pandas | 2.0+ | æ•°æ®å¤„ç† |
| numpy | 1.24+ | æ•°å€¼è®¡ç®— |

---

## åˆå§‹åŒ–é¡¹ç›® (æŒ‰åœºæ™¯é€‰æ‹©)

### åœºæ™¯ä¸€ï¼šæ–°ç”µè„‘é¦–æ¬¡é…ç½® (æ¨è)

é€‚ç”¨äºï¼šåˆšå…‹éš†é¡¹ç›®ï¼Œç”µè„‘ä¸Šæ²¡æœ‰ quants ç¯å¢ƒ

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd Q_System

# 2. ä¸€é”®é…ç½® (åŒå‡»è¿è¡Œ)
scripts\setup\setup_env.bat
```

è¯¥è„šæœ¬ä¼šè‡ªåŠ¨ï¼šåˆ›å»º quants ç¯å¢ƒ â†’ å®‰è£…ä¾èµ– â†’ å®‰è£… xtquant â†’ éªŒè¯ç¯å¢ƒ

### åœºæ™¯äºŒï¼šå·²æœ‰ quants ç¯å¢ƒ

é€‚ç”¨äºï¼šç”µè„‘ä¸Šå·²å­˜åœ¨ quants conda ç¯å¢ƒ

```bash
# 1. æ¿€æ´»ç¯å¢ƒ
conda activate quants

# 2. éªŒè¯ç¯å¢ƒ
python scripts/verify/check_env.py

# 3. å¦‚æœ‰ç¼ºå¤±ä¾èµ–ï¼Œè¡¥å……å®‰è£…
pip install -r requirements.txt
```

### åœºæ™¯ä¸‰ï¼šå¤š Python ç‰ˆæœ¬æ··ä¹±çš„ç”µè„‘

é€‚ç”¨äºï¼šç³»ç»Ÿå®‰è£…äº†å¤šä¸ª Python ç‰ˆæœ¬ï¼Œå­˜åœ¨åŒ…åŠ è½½æ··ä¹±

**ç—‡çŠ¶æ£€æµ‹**ï¼š

```bash
conda activate quants
python scripts/verify/check_env.py
# å¦‚æœçœ‹åˆ° "[WARN] æ£€æµ‹åˆ° X ä¸ª site-packages è·¯å¾„ï¼Œå¯èƒ½å­˜åœ¨ç‰ˆæœ¬æ··ä¹±"
```

**è§£å†³æ–¹æ¡ˆ A - ä½¿ç”¨éš”ç¦»æ¨¡å¼å¯åŠ¨ (æ¨è)**ï¼š

```bash
# åŒå‡»æ­¤è„šæœ¬å¯åŠ¨å¼€å‘ç¯å¢ƒ
scripts\setup\start_isolated.bat
```

è¯¥è„šæœ¬è®¾ç½® `PYTHONNOUSERSITE=1`ï¼Œç¦ç”¨ç”¨æˆ·å…¨å±€åŒ…ï¼Œç¡®ä¿åªä½¿ç”¨ conda ç¯å¢ƒã€‚

**è§£å†³æ–¹æ¡ˆ B - ä¿®å¤ç¯å¢ƒéš”ç¦»**ï¼š

```bash
# é‡æ–°å®‰è£…åŒ…åˆ° conda ç¯å¢ƒ
scripts\setup\fix_env_isolation.bat
```

### åœºæ™¯å››ï¼šæ‰‹åŠ¨ä»é›¶åˆ›å»ºç¯å¢ƒ

é€‚ç”¨äºï¼šéœ€è¦å®Œå…¨æ§åˆ¶ç¯å¢ƒé…ç½®

```bash
# 1. åˆ›å»º Python 3.8 ç¯å¢ƒ (ç‰ˆæœ¬å¿…é¡»æ˜¯ 3.8)
conda create -n quants python=3.8 -y

# 2. æ¿€æ´»ç¯å¢ƒ
conda activate quants

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

    ```text
    å®Œæ•´å‘½ä»¤ç¤ºä¾‹ (ä»¥é˜¿é‡Œæºä¸ºä¾‹):
    requirements-dev.txt
    
    è¿è¡Œ
    pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple/
    å¸¸ç”¨å›½å†…é•œåƒæºåœ°å€ï¼š
    é˜¿é‡Œäº‘ (æ¨è): https://mirrors.aliyun.com/pypi/simple/
    æ¸…åå¤§å­¦: https://pypi.tuna.tsinghua.edu.cn/simple/
    åä¸ºäº‘: https://repo.huaweicloud.com/repository/pypi/simple/
    è±†ç“£: http://pypi.douban.com/simple/
    ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦: https://pypi.mirrors.ustc.edu.cn/simple/
    ```

# 4. å®‰è£… xtquant
pip install xtquant

# 5. éªŒè¯
python scripts/verify/check_env.py
```

### åœºæ™¯äº”ï¼šä» environment.yml æ¢å¤ç¯å¢ƒ

é€‚ç”¨äºï¼šéœ€è¦å®Œå…¨å¤åˆ¶ç°æœ‰ç¯å¢ƒé…ç½®

```bash
# 1. ä» YAML åˆ›å»ºç¯å¢ƒ
conda env create -f environment.yml

# 2. æ¿€æ´»ç¯å¢ƒ
conda activate quants

# 3. å®‰è£… xtquant (YAML ä¸­æœªåŒ…å«)
pip install xtquant
```

---

## æ—¥å¸¸å¼€å‘å¯åŠ¨

### æ–¹å¼ä¸€ï¼šéš”ç¦»æ¨¡å¼å¯åŠ¨ (æ¨è)

```bash
# åŒå‡»è¿è¡Œï¼Œè‡ªåŠ¨é…ç½®éš”ç¦»ç¯å¢ƒ
scripts\setup\start_isolated.bat

# ç„¶ååœ¨æ‰“å¼€çš„çª—å£ä¸­è¿è¡Œ
python main.py
```

### æ–¹å¼äºŒï¼šå¸¸è§„å¯åŠ¨

```bash
# æ¿€æ´»ç¯å¢ƒ
conda activate quants

# è¿è¡Œé¡¹ç›®
python main.py
```

### æ–¹å¼ä¸‰ï¼šå‘½ä»¤è¡Œä¸€æ­¥å¯åŠ¨

```bash
# ä½¿ç”¨ conda run (æ— éœ€æ¿€æ´»)
conda run -n quants python main.py
```

---

## ç¯å¢ƒéªŒè¯

### å¿«é€Ÿæ£€æŸ¥

```bash
# åŒå‡»è¿è¡Œ
scripts\utils\check.bat
```

### è¯¦ç»†æ£€æŸ¥

```bash
conda activate quants
python scripts/verify/check_env.py
```

### éªŒè¯é€šè¿‡æ ‡å‡†

```text
[PASS] Python ç‰ˆæœ¬     â† 3.8.x
[PASS] Conda ç¯å¢ƒ      â† quants
[PASS] æ ¸å¿ƒä¾èµ–åŒ…      â† pandas, numpy
[PASS] XtQuant         â† xtdata å¯ç”¨
[PASS] é¡¹ç›®æ¨¡å—        â† å…¨éƒ¨å¯å¯¼å…¥
```

> è¯¦ç»†æ–‡æ¡£: [docs/guides/ENVIRONMENT.md](docs/guides/ENVIRONMENT.md) | [docs/guides/SETUP_GUIDE.md](docs/guides/SETUP_GUIDE.md)

## å¿«é€Ÿå¼€å§‹

### Week 2: é‡‘èæ•°æ®å·¥ç¨‹å¿«é€Ÿå…¥é—¨

#### 1. é…ç½®XtData API

ç¼–è¾‘ `config.py` æ–‡ä»¶ï¼Œé…ç½®ä½ çš„XtDataè´¦æˆ·ä¿¡æ¯ï¼š

```python
# XtData APIé…ç½®
XTDATA_ACCOUNT_ID = 'ä½ çš„è´¦æˆ·ID'
XTDATA_ACCOUNT_KEY = 'ä½ çš„è´¦æˆ·å¯†é’¥'

# æ•°æ®å­˜å‚¨è·¯å¾„
DATA_STORAGE_PATH = './data'
```

#### 2. è¿è¡Œç¤ºä¾‹è„šæœ¬

```bash
# æ¿€æ´»ç¯å¢ƒ
conda activate quants

# ç¤ºä¾‹1: è·å–å¸‚åœºæ•°æ®
python examples/01_basic_data_retrieval.py

# ç¤ºä¾‹2: ä»·æ ¼å¤æƒå¤„ç†
python examples/02_price_adjustment.py

# ç¤ºä¾‹3: åŸºæœ¬é¢æ•°æ®åˆ†æ
python examples/03_fundamental_data.py

# ç¤ºä¾‹4: è¡Œä¸šåˆ†ç±»æŸ¥è¯¢
python examples/04_industry_classification.py

# ç¤ºä¾‹5: æ•°æ®æŒä¹…åŒ–
python examples/05_data_persistence.py

# ç¤ºä¾‹6: Kçº¿å›¾å¯è§†åŒ–
python examples/06_visualization.py

# ç¤ºä¾‹7: å¢é‡æ›´æ–°
python examples/07_incremental_update.py
```

#### 3. æ„å»ºæœ¬åœ°æ•°æ®åº“

```bash
# ä¸‹è½½å…¨å¸‚åœºæ—¥çº¿æ•°æ®ï¼ˆéœ€è¦è¾ƒé•¿æ—¶é—´ï¼‰
python examples/09_build_local_database.py
```

#### 4. æ•°æ®å·¥ç¨‹APIä½¿ç”¨ç¤ºä¾‹

```python
from src.xtdata_client import XtDataClient
from src.data_retriever import DataRetriever
from src.price_adjuster import PriceAdjuster
from src.data_manager import DataManager
from config import XTDATA_ACCOUNT_ID, XTDATA_ACCOUNT_KEY, DATA_STORAGE_PATH

# 1. åˆå§‹åŒ–å®¢æˆ·ç«¯
client = XtDataClient(XTDATA_ACCOUNT_ID, XTDATA_ACCOUNT_KEY)
client.connect()

# 2. è·å–å†å²æ•°æ®
retriever = DataRetriever(client)
data = retriever.download_history_data(
    stock_codes=['000001.SZ', '600000.SH'],
    start_date='20240101',
    end_date='20241231',
    period='1d'
)

# 3. åº”ç”¨å‰å¤æƒï¼ˆå›æµ‹æ¨èï¼‰
adjuster = PriceAdjuster(client)
adjusted_data = adjuster.forward_adjust(data, '000001.SZ')

# 4. ä¿å­˜åˆ°æœ¬åœ°æ•°æ®åº“
manager = DataManager(DATA_STORAGE_PATH)
manager.save_market_data(adjusted_data, 'daily', '000001.SZ')

# 5. å¢é‡æ›´æ–°
new_records = manager.incremental_update(
    retriever,
    ['000001.SZ', '600000.SH'],
    'daily'
)
print(f"æ›´æ–°äº† {new_records} æ¡æ–°è®°å½•")

# 6. æŸ¥è¯¢æ•°æ®
loaded_data = manager.load_market_data(
    'daily',
    stock_code='000001.SZ',
    start_date='20240601',
    end_date='20240630'
)
```

### ç­–ç•¥å¼€å‘å¿«é€Ÿå…¥é—¨

### è¿è¡Œå›æµ‹

```bash
python main.py
```

é»˜è®¤é…ç½®ï¼š

- æ ‡çš„: æ¯”äºšè¿ª (002594.SZ)
- æ—¶é—´: 2025-01-01 ~ 2025-12-25
- ç­–ç•¥: åŒå‡çº¿ç­–ç•¥ (MA5/MA20)

### è¿è¡Œå®ç›˜ (æ¨¡æ‹Ÿæ¨¡å¼)

```bash
python run_live.py
```

> é¦–æ¬¡è¿è¡Œé»˜è®¤ä¸º `sim` æ¨¡æ‹Ÿæ¨¡å¼ï¼Œä¸ä¼šå‘é€çœŸå®è®¢å•ã€‚

## ç­–ç•¥å¼€å‘

æ‰€æœ‰ç­–ç•¥éœ€ç»§æ‰¿ `BaseStrategy` å¹¶å®ç°ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•ï¼š

```python
from core.strategy import BaseStrategy

class MyStrategy(BaseStrategy):

    def initialize(self, context):
        """ç­–ç•¥åˆå§‹åŒ–ï¼Œåªæ‰§è¡Œä¸€æ¬¡"""
        context.user_data['target'] = '000001.SZ'

    def handle_bar(self, context, bar_dict):
        """æ¯æ ¹ K çº¿æ‰§è¡Œä¸€æ¬¡"""
        stock = context.user_data['target']
        if stock not in bar_dict:
            return

        bar = bar_dict[stock]
        # ç­–ç•¥é€»è¾‘...

        if should_buy:
            context.order(stock, 1000)   # ä¹°å…¥ 1000 è‚¡
        elif should_sell:
            context.order(stock, -1000)  # å–å‡º 1000 è‚¡
```

### Context å¯¹è±¡

| å±æ€§/æ–¹æ³• | è¯´æ˜ |
| ---------- | ------ |
| `cash` | å¯ç”¨èµ„é‡‘ |
| `total_asset` | æ€»èµ„äº§ |
| `positions` | æŒä»“å­—å…¸ `{stock_code: volume}` |
| `current_dt` | å½“å‰æ—¶é—´ |
| `user_data` | ç­–ç•¥è‡ªå®šä¹‰å˜é‡å­˜å‚¨ |
| `order(stock, volume)` | ä¸‹å• (æ­£æ•°ä¹°å…¥ï¼Œè´Ÿæ•°å–å‡º) |
| `log(msg)` | æ—¥å¿—è¾“å‡º |

## å®‰å…¨æœºåˆ¶

å®ç›˜æ¨¡å¼å†…ç½®åŒé‡ä¿æŠ¤ï¼š

### 1. è¿è¡Œæ¨¡å¼é”

```python
RUN_MODE = 'sim'   # 'sim' æ¨¡æ‹Ÿæ¨¡å¼ | 'real' å®ç›˜æ¨¡å¼
```

åªæœ‰æ˜ç¡®è®¾ç½®ä¸º `'real'` æ—¶æ‰ä¼šå‘é€çœŸå®è®¢å•ã€‚

### 2. äººå·¥ç¡®è®¤é˜²ç«å¢™

```python
MANUAL_CONFIRM = True  # ä¸‹å•å‰å¿…é¡»æ‰‹åŠ¨è¾“å…¥ 'y' ç¡®è®¤
```

å®ç›˜æ¨¡å¼ä¸‹ï¼Œæ¯ç¬”è®¢å•éƒ½ä¼šé˜»å¡ç­‰å¾…ç”¨æˆ·ç¡®è®¤ï¼š

```text
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!! [æ•™å­¦å®ç›˜æ‹¦æˆª] æ­£å‡†å¤‡å‘é€äº¤æ˜“æŒ‡ä»¤ !!!
!!! æ ‡çš„: 002594.SZ
!!! æ–¹å‘: ä¹°å…¥
!!! æ•°é‡: 1000
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
>>> è¯·è¾“å…¥ 'y' ç¡®è®¤ä¸‹å•ï¼Œè¾“å…¥å…¶ä»–ä»»æ„é”®å–æ¶ˆ:
```

## æ•°æ®æµ

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   XtQuant   â”‚â”€â”€â”€â”€â–¶â”‚   Engine    â”‚â”€â”€â”€â”€â–¶â”‚  Strategy   â”‚
â”‚  (æ•°æ®æº)   â”‚     â”‚ (æ—¶é—´å¾ªç¯)  â”‚     â”‚ (äº¤æ˜“é€»è¾‘)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                          â”‚                   â”‚
                          â–¼                   â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚          Context            â”‚
                    â”‚  (èµ„é‡‘/æŒä»“/ä¸‹å•/æ—¥å¿—)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## é…ç½®è¯´æ˜

### å›æµ‹é…ç½® (main.py)

```python
start_date = '20250101'      # å›æµ‹å¼€å§‹æ—¥æœŸ
end_date = '20251225'        # å›æµ‹ç»“æŸæ—¥æœŸ
stock_list = ['002594.SZ']   # è‚¡ç¥¨åˆ—è¡¨
```

### å®ç›˜é…ç½® (run_live.py)

```python
MINI_QMT_PATH = r'D:\è¿…æŠ•æé€Ÿäº¤æ˜“ç»ˆç«¯\userdata_mini'  # QMT è·¯å¾„
ACCOUNT_ID = 'æ‚¨çš„è´¦å·'       # èµ„é‡‘è´¦å·
RUN_MODE = 'sim'             # è¿è¡Œæ¨¡å¼
MANUAL_CONFIRM = True        # äººå·¥ç¡®è®¤
```

## License

MIT

---

## APIæ–‡æ¡£

### æ ¸å¿ƒæ¨¡å—æ–‡æ¡£

- **XtDataClient**: [src/xtdata_client.py](src/xtdata_client.py) - XtData APIå®¢æˆ·ç«¯å°è£…
- **DataRetriever**: [src/data_retriever.py](src/data_retriever.py) - å¸‚åœºæ•°æ®è·å–å™¨
- **PriceAdjuster**: [src/price_adjuster.py](src/price_adjuster.py) - ä»·æ ¼å¤æƒå¤„ç†å™¨
- **FundamentalHandler**: [src/fundamental_handler.py](src/fundamental_handler.py) - åŸºæœ¬é¢æ•°æ®å¤„ç†å™¨
- **IndustryMapper**: [src/industry_mapper.py](src/industry_mapper.py) - è¡Œä¸šåˆ†ç±»æ˜ å°„å™¨
- **DataManager**: [src/data_manager.py](src/data_manager.py) - æ•°æ®æŒä¹…åŒ–ç®¡ç†å™¨
- **Visualizer**: [src/visualizer.py](src/visualizer.py) - é‡‘èæ•°æ®å¯è§†åŒ–å™¨

### è¯¦ç»†æ–‡æ¡£

- [XtData APIå‚è€ƒ](docs/api/xtdata.md) - XtDataæ¥å£è¯¦ç»†è¯´æ˜
- [ç¤ºä¾‹è„šæœ¬è¯´æ˜](examples/README.md) - æ‰€æœ‰ç¤ºä¾‹è„šæœ¬çš„ä½¿ç”¨æŒ‡å—
- [120å¤©å­¦ä¹ è®¡åˆ’](docs/plans/plan.md) - å®Œæ•´çš„åŸ¹è®­è®¡åˆ’å’Œå­¦ä¹ è·¯å¾„

### åœ¨çº¿èµ„æº

- [XtQuantå®˜æ–¹æ–‡æ¡£](https://dict.thinktrader.net/nativeApi/start_now.html)
- [Pandaså®˜æ–¹æ–‡æ¡£](https://pandas.pydata.org/docs/)
- [Hypothesisæµ‹è¯•åº“](https://hypothesis.readthedocs.io/)

---

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•è·å–XtDataè´¦æˆ·ï¼Ÿ

è®¿é—®å›½é‡‘è¯åˆ¸QMTå®˜ç½‘æ³¨å†Œè´¦æˆ·ï¼Œè·å–APIå¯†é’¥ã€‚

### Q2: å‰å¤æƒå’Œåå¤æƒæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

- **å‰å¤æƒ**: ä¿æŒå½“å‰ä»·æ ¼ä¸å˜ï¼Œå‘å‰è°ƒæ•´å†å²ä»·æ ¼ã€‚é€‚ç”¨äºå›æµ‹ï¼Œé¿å…æœªæ¥å‡½æ•°ã€‚
- **åå¤æƒ**: ä¿æŒå†å²ä»·æ ¼ä¸å˜ï¼Œå‘åè°ƒæ•´å½“å‰ä»·æ ¼ã€‚é€‚ç”¨äºå±•ç¤ºï¼Œä¿æŒä»·æ ¼è¿ç»­æ€§ã€‚

è¯¦è§ï¼š[examples/02_price_adjustment.py](examples/02_price_adjustment.py)

### Q3: ä»€ä¹ˆæ˜¯æœªæ¥å‡½æ•°ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ

æœªæ¥å‡½æ•°æ˜¯æŒ‡åœ¨å†å²åˆ†æä¸­ä½¿ç”¨äº†æœªæ¥ä¿¡æ¯çš„é”™è¯¯ã€‚ç³»ç»Ÿé€šè¿‡ä»¥ä¸‹æœºåˆ¶é˜²èŒƒï¼š

1. åŸºæœ¬é¢æ•°æ®ä½¿ç”¨å…¬å‘Šæ—¥æœŸï¼ˆannounce_dateï¼‰è€ŒéæŠ¥å‘ŠæœŸ
2. å›æµ‹é»˜è®¤ä½¿ç”¨å‰å¤æƒ
3. æ•°æ®å¯¹é½é‡‡ç”¨ä¿å®ˆç­–ç•¥

è¯¦è§ï¼š[examples/10_lookahead_bias_demo.py](examples/10_lookahead_bias_demo.py)

### Q4: å¦‚ä½•å¤„ç†æ•°æ®ç¼ºå¤±ï¼Ÿ

ç³»ç»Ÿæä¾›å¤šå±‚æ•°æ®è´¨é‡æ£€æŸ¥ï¼š

```python
from src.data_manager import DataManager

manager = DataManager('./data')
# æ•°æ®éªŒè¯ä¼šè‡ªåŠ¨æ£€æµ‹ï¼š
# - å¼‚å¸¸å€¼ï¼ˆè´Ÿä»·æ ¼ã€æç«¯å€¼ï¼‰
# - æ•°æ®ç¼ºå£
# - æ•°æ®ç±»å‹é”™è¯¯
```

### Q5: å¢é‡æ›´æ–°å¦‚ä½•å·¥ä½œï¼Ÿ

å¢é‡æ›´æ–°è‡ªåŠ¨è¯†åˆ«æœ€åæ›´æ–°æ—¥æœŸï¼Œä»…è·å–æ–°æ•°æ®ï¼š

```python
# é¦–æ¬¡è¿è¡Œï¼šä¸‹è½½å…¨éƒ¨å†å²æ•°æ®
manager.incremental_update(retriever, ['000001.SZ'], 'daily')

# åç»­è¿è¡Œï¼šä»…ä¸‹è½½æ–°å¢æ•°æ®
manager.incremental_update(retriever, ['000001.SZ'], 'daily')
```

---

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

### å¼€å‘ç¯å¢ƒè®¾ç½®

```bash
# å®‰è£…å¼€å‘ä¾èµ–
pip install -r requirements-dev.txt

# è¿è¡Œæµ‹è¯•
pytest tests/

# è¿è¡Œå±æ€§æµ‹è¯•
pytest tests/property/ -v --hypothesis-show-statistics

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=src --cov-report=html
```

### ä»£ç è§„èŒƒ

- éµå¾ªPEP 8ä»£ç é£æ ¼
- æ‰€æœ‰å…¬å…±å‡½æ•°å¿…é¡»æœ‰æ–‡æ¡£å­—ç¬¦ä¸²
- æ–°åŠŸèƒ½éœ€è¦æ·»åŠ å•å…ƒæµ‹è¯•å’Œå±æ€§æµ‹è¯•
- æäº¤å‰è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶

---

## è‡´è°¢

æœ¬é¡¹ç›®åŸºäºå›½é‡‘è¯åˆ¸XtQuantå¹³å°å¼€å‘ï¼Œæ„Ÿè°¢å›½é‡‘è¯åˆ¸æä¾›çš„APIæ”¯æŒã€‚

---

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- æäº¤Issue: [GitHub Issues](https://github.com/your-repo/issues)
- é‚®ä»¶: <your-email@example.com>

---

## Happy Quant Trading! ğŸ“ˆ

#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
Day 1: ç¯å¢ƒé…ç½®éªŒè¯
å­¦ä¹ ç›®æ ‡: ç¡®ä¿Python 3.8ç¯å¢ƒæ­£ç¡®é…ç½®ï¼ŒMiniQMTå¯ç”¨
é¢„è®¡æ—¶é—´: 2-3å°æ—¶

è¿è¡Œæ–¹å¼:
    conda activate quants
    python exercises/week1/day1_env_check.py

# === ç»ƒä¹ 1: æ£€æŸ¥Pythonç‰ˆæœ¬ ===
# === ç»ƒä¹ 2: æµ‹è¯•xtquantå¯¼å…¥ ===
# === ç»ƒä¹ 3: æµ‹è¯•é¡¹ç›®æ¨¡å—å¯¼å…¥ ===

"""

import sys  # å¯¼å…¥sysæ¨¡å—ï¼Œç”¨äºæ£€æŸ¥Pythonç‰ˆæœ¬å’Œè·¯å¾„ä¿¡æ¯ï¼Œ
            # ä¾‹å¦‚ï¼š
            # sys.version_info è¿”å›Pythonç‰ˆæœ¬ä¿¡æ¯ï¼Œ
            # sys.path è¿”å›æ¨¡å—æœç´¢è·¯å¾„åˆ—è¡¨ï¼Œ
            # å¯ä»¥ç”¨äºæ£€æŸ¥æ¨¡å—æ˜¯å¦æ­£ç¡®å¯¼å…¥ï¼Œ
            # æˆ–è€…åœ¨è¿è¡Œæ—¶åŠ¨æ€ä¿®æ”¹æ¨¡å—æœç´¢è·¯å¾„ã€‚
            # å‚è€ƒæ–‡æ¡£: https://docs.python.org/3/library/sys.html

# === ç»ƒä¹ 1: æ£€æŸ¥Pythonç‰ˆæœ¬ ===
def exercise_1_check_python_version():
    """
    ç»ƒä¹ 1: æ£€æŸ¥Pythonç‰ˆæœ¬æ˜¯å¦ä¸º3.8.x
    
    çŸ¥è¯†ç‚¹:
    - sys.version_info è¿”å›Pythonç‰ˆæœ¬ä¿¡æ¯
    - MiniQMT è¦æ±‚ Python 3.8.x
    """
    print("=" * 50)
    print("ç»ƒä¹ 1: æ£€æŸ¥Pythonç‰ˆæœ¬")
    print("=" * 50)
    
    version = sys.version_info          # è·å–å½“å‰Pythonç‰ˆæœ¬ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ªå‘½åå…ƒç»„ï¼ŒåŒ…å« major, minor, micro ç­‰å­—æ®µï¼Œ
                                        # ä¾‹å¦‚ï¼šsys.version_info(major=3, minor=8, micro=13, releaselevel='final', serial=0)
                                        # å¯ä»¥é€šè¿‡ version.major, version.minor, version.micro è®¿é—®å…·ä½“ç‰ˆæœ¬å·
                                        # å‚è€ƒæ–‡æ¡£: https://docs.python.org/3/library/sys.html#sys.version_info
                                        # MiniQMT å®˜æ–¹è¦æ±‚ Python 3.8.x ç‰ˆæœ¬
                                        # ä¾‹å¦‚ï¼š3.8.10, 3.8.13 ç­‰
                                        # æ³¨æ„ï¼šä¸åŒçš„æ“ä½œç³»ç»Ÿå’Œç¯å¢ƒå¯èƒ½ä¼šæœ‰ä¸åŒçš„Pythonç‰ˆæœ¬ï¼Œç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ç‰ˆæœ¬éå¸¸é‡è¦ã€‚
                                        # å¦‚æœç‰ˆæœ¬ä¸æ­£ç¡®ï¼Œå¯èƒ½ä¼šå¯¼è‡´xtquantç­‰æ¨¡å—æ— æ³•æ­£å¸¸å·¥ä½œã€‚
                                        # å»ºè®®ä½¿ç”¨Anacondaåˆ›å»ºä¸“é—¨çš„Python 3.8ç¯å¢ƒã€‚
                                        # ä¾‹å¦‚ï¼šconda create -n quants python=3.8
                                        # ç„¶åæ¿€æ´»ç¯å¢ƒï¼šconda activate quants
                                        # ä¹‹åå†è¿è¡Œæœ¬è„šæœ¬è¿›è¡ŒéªŒè¯ã€‚
                                        # è¿è¡Œæœ¬è„šæœ¬åï¼Œå¦‚æœç‰ˆæœ¬æ­£ç¡®ï¼Œä¼šæ˜¾ç¤º âœ“ Pythonç‰ˆæœ¬æ­£ç¡® (3.8.x)
                                        # å¦åˆ™ä¼šæ˜¾ç¤º âœ— Pythonç‰ˆæœ¬ä¸æ­£ç¡®ï¼Œéœ€è¦3.8.x

    print(f"å½“å‰Pythonç‰ˆæœ¬: {version.major}.{version.minor}.{version.micro}")
    print(f"Pythonæ‰§è¡Œè·¯å¾„: {sys.executable}")
    
    if version.major == 3 and version.minor == 8:
        print("âœ“ Pythonç‰ˆæœ¬æ­£ç¡® (3.8.x)")
        return True
    else:
        print("âœ— Pythonç‰ˆæœ¬ä¸æ­£ç¡®ï¼Œéœ€è¦3.8.x")
        return False


# === ç»ƒä¹ 2: æµ‹è¯•xtquantå¯¼å…¥ ===
from datetime import datetime # å¯¼å…¥datetimeä»¥é˜²æ­¢æœªä½¿ç”¨å¯¼å…¥è­¦å‘Šï¼Œç”¨äºå°†æ—¶é—´æˆ³è½¬æ¢ä¸ºæ—¥æœŸå­—ç¬¦ä¸²ï¼Œæ–¹ä¾¿é˜…è¯»ï¼Œ
                                # ä¾‹å¦‚ï¼š2023-10-10 15:30:00ï¼Œ
                                # è½¬æ¢ä¸ºæ—¥æœŸå­—ç¬¦ä¸²åä¸ºï¼š2023-10-10ï¼Œ
                                # æ–¹ä¾¿æŸ¥çœ‹å’Œåˆ†ææ•°æ®ã€‚

def exercise_2_test_xtquant_import():
    """
    ç»ƒä¹ 2: æµ‹è¯•xtquantæ¨¡å—æ˜¯å¦å¯ä»¥æ­£å¸¸å¯¼å…¥
    
    çŸ¥è¯†ç‚¹:
    - xtquant æ˜¯å›½é‡‘è¯åˆ¸QMTçš„Pythonæ¥å£
    - xtdata ç”¨äºè·å–è¡Œæƒ…æ•°æ®
    - xttrader ç”¨äºäº¤æ˜“æ“ä½œ
    """
    print("\n" + "=" * 50)
    print("ç»ƒä¹ 2: æµ‹è¯•xtquantå¯¼å…¥")
    print("=" * 50)
    
    try:                                                # å°è¯•å¯¼å…¥xtquantæ¨¡å—ï¼Œ
                                                        # å¦‚æœå¯¼å…¥å¤±è´¥ï¼Œä¼šæŠ›å‡ºImportErrorå¼‚å¸¸
                                                        # ä¾‹å¦‚ï¼šå¦‚æœæ²¡æœ‰å®‰è£…xtquantæ¨¡å—ï¼Œä¼šæŠ›å‡ºImportErrorå¼‚å¸¸
                                                        # å¯ä»¥ä½¿ç”¨condaå®‰è£…xtquantæ¨¡å—ï¼šconda install -c conda-forge xtquant

        from xtquant import xtdata  # xtdataæ¨¡å—ç”¨äºè·å–è¡Œæƒ…æ•°æ®ï¼Œä¾‹å¦‚ï¼šè‚¡ç¥¨ã€æœŸè´§ã€æœŸæƒç­‰
        print("âœ“ xtdata æ¨¡å—å¯¼å…¥æˆåŠŸ")
        
        # æµ‹è¯•è·å–äº¤æ˜“æ—¥åˆ—è¡¨
        trading_dates = xtdata.get_trading_dates('SH')  # è·å–ä¸Šæµ·å¸‚åœºçš„äº¤æ˜“æ—¥åˆ—è¡¨ï¼Œ
                                                        # ä¾‹å¦‚ï¼š['2023-10-10', '2023-10-11', ...]
                                                        # æ³¨æ„ï¼šè¿”å›çš„æ˜¯å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯æ—¥æœŸå­—ç¬¦ä¸²ï¼Œæ ¼å¼ä¸ºYYYY-MM-DD
                                                        # ä¾‹å¦‚ï¼š2023-10-10 15:30:00ï¼Œ
                                                        # è½¬æ¢ä¸ºæ—¥æœŸå­—ç¬¦ä¸²åä¸ºï¼š2023-10-10ï¼Œ
                                                        # æ–¹ä¾¿æŸ¥çœ‹å’Œåˆ†ææ•°æ®ã€‚

        if trading_dates and len(trading_dates) > 0:


            # xtdata é€šå¸¸è¿”å›æ¯«ç§’æ—¶é—´æˆ³ï¼ˆintï¼‰ï¼Œè½¬æ¢ä¸º YYYY-MM-DD
            def _to_date_str(ts):
                # è½¬æ¢ä¸ºæ—¥æœŸå­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼š2023-10-10 15:30:00 -> 2023-10-10
                # æ³¨æ„ï¼šxtdata é€šå¸¸è¿”å›æ¯«ç§’æ—¶é—´æˆ³ï¼ˆintï¼‰ï¼Œéœ€è¦é™¤ä»¥1000è½¬æ¢ä¸ºç§’
                # å‚è€ƒæ–‡æ¡£: https://docs.python.org/3/library/datetime.html#datetime.datetime.fromtimestamp
                # ä¾‹å¦‚ï¼š2023-10-10 15:30:00 çš„æ—¶é—´æˆ³ä¸º 1696952200000ï¼Œ
                # è½¬æ¢ä¸ºç§’åä¸º 1696952200ï¼Œ
                # å†è½¬æ¢ä¸ºæ—¥æœŸå­—ç¬¦ä¸²ä¸º 2023-10-10
                # æ–¹ä¾¿æŸ¥çœ‹å’Œåˆ†ææ•°æ®ã€‚

                # ç¡®ä¿tsæ˜¯æ•´æ•°ç±»å‹ï¼Œå¦åˆ™è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¿”å›
                try:                                                                    # æ•è·å¼‚å¸¸ï¼Œé˜²æ­¢è½¬æ¢å¤±è´¥
                                                                                        # ä¾‹å¦‚ï¼šå¦‚æœtsä¸æ˜¯æ•´æ•°ç±»å‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´è½¬æ¢å¤±è´¥
                    ts_int = int(ts)                                                    # ç¡®ä¿æ˜¯æ•´æ•°ç±»å‹ï¼Œ
                                                                                        # ä¾‹å¦‚ï¼š1696952200000 -> 1696952200
                                                                                        # æ–¹ä¾¿è¿›è¡Œæ—¶é—´æˆ³è½¬æ¢
                                                                                        # æ³¨æ„ï¼šå¦‚æœtsä¸æ˜¯æ•´æ•°ç±»å‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´è½¬æ¢å¤±è´¥
                                                                                        # éœ€è¦è¿›è¡Œå¼‚å¸¸å¤„ç†
                                                                                        # å‚è€ƒæ–‡æ¡£: https://docs.python.org/3/library/functions.html#int

                    return datetime.fromtimestamp(ts_int / 1000).strftime('%Y-%m-%d')   # è½¬æ¢ä¸ºæ—¥æœŸå­—ç¬¦ä¸²ï¼Œæ ¼å¼ä¸ºYYYY-MM-DD
                except Exception:                                                       # æ•è·æ‰€æœ‰å¼‚å¸¸
                    return str(ts)                                                      # å¦‚æœè½¬æ¢å¤±è´¥ï¼Œè¿”å›åŸå§‹å­—ç¬¦ä¸²
                

            readable_dates = [_to_date_str(d) for d in trading_dates]                   # è½¬æ¢ä¸ºå¯è¯»æ—¥æœŸå­—ç¬¦ä¸²åˆ—è¡¨
                                                                                        # readable_datesï¼šæ–°ç”Ÿæˆçš„ â€œå¯è¯»æ—¥æœŸå­—ç¬¦ä¸²åˆ—è¡¨â€ï¼ˆç»“æœï¼‰
                                                                                        # _to_date_str(d)ï¼šå¯¹æ¯ä¸ªå…ƒç´ çš„ â€œè½¬æ¢æ“ä½œâ€ï¼ˆè°ƒç”¨è‡ªå®šä¹‰å‡½æ•°å¤„ç†æ—¥æœŸï¼‰
                                                                                        # dï¼šå¾ªç¯ä¸­éå†åŸå§‹åˆ—è¡¨æ—¶ï¼Œæ¯ä¸ªå…ƒç´ çš„ä¸´æ—¶å˜é‡åï¼ˆå¯è‡ªå®šä¹‰ï¼Œæ¯”å¦‚dateï¼‰
                                                                                        # trading_datesï¼šåŸå§‹åˆ—è¡¨ï¼ˆå­˜å‚¨ç€æœªè½¬æ¢çš„æ—¥æœŸæ•°æ®ï¼Œæ¯”å¦‚æ—¶é—´æˆ³ã€datetime å¯¹è±¡ã€æ•°å­—ç­‰ï¼‰


            print(f"âœ“ è·å–äº¤æ˜“æ—¥æˆåŠŸï¼Œå…± {len(readable_dates)} ä¸ªäº¤æ˜“æ—¥")                 # æ˜¾ç¤ºè·å–åˆ°çš„äº¤æ˜“æ—¥æ•°é‡

            print(f"  æœ€è¿‘5ä¸ªäº¤æ˜“æ—¥: {readable_dates[-5:]}")                             # æ˜¾ç¤ºæœ€è¿‘5ä¸ªäº¤æ˜“æ—¥ï¼Œprint(readable_dates[-5:])ï¼šåˆ‡ç‰‡æ“ä½œï¼Œè·å–åˆ—è¡¨çš„æœ€å5ä¸ªå…ƒç´ 
        else:
            print("âš  è·å–äº¤æ˜“æ—¥è¿”å›ç©ºæ•°æ®")
            
        return True
        
    except ImportError as e:                                                            # æ•è·å¯¼å…¥å¼‚å¸¸
        print(f"âœ— xtquant å¯¼å…¥å¤±è´¥: {e}")
        print("  è¯·ç¡®ä¿å·²å®‰è£…: pip install xtquant")
        return False
    
    except Exception as e:                                                              # æ•è·å…¶ä»–å¼‚å¸¸ï¼Œ
                                                                                        # ä¾‹å¦‚ï¼šå¦‚æœMiniQMTæœªå¯åŠ¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´è·å–äº¤æ˜“æ—¥å¤±è´¥
        print(f"âš  xtquant å¯¼å…¥æˆåŠŸï¼Œä½†æµ‹è¯•æ—¶å‡ºé”™: error = {e}")
        print("\n" + "Â· " * 50)

        print("  è¿™å¯èƒ½æ˜¯å› ä¸ºMiniQMTæœªå¯åŠ¨")
        return True  # å¯¼å…¥æˆåŠŸå³å¯


# === ç»ƒä¹ 3: æµ‹è¯•é¡¹ç›®æ¨¡å—å¯¼å…¥ ===
"""
è¿™ä¸ªå‡½æ•°çš„æ ¸å¿ƒç›®çš„æ˜¯ **éªŒè¯é¡¹ç›®æ¨¡å—åŒ–è®¾è®¡çš„å¯ç”¨æ€§ï¼Œç¡®ä¿æ ¸å¿ƒç»„ä»¶å’Œç­–ç•¥æ¨¡å—èƒ½è¢«æ­£ç¡®å¯¼å…¥**ï¼Œä¸ºåç»­é¡¹ç›®è¿è¡Œï¼ˆå¦‚å›æµ‹ã€ç­–ç•¥æ‰§è¡Œï¼‰æ‰«æ¸…åŸºç¡€ä¾èµ–éšœç¢ã€‚

å…·ä½“å¯ä»¥æ‹†è§£ä¸º3ä¸ªå…³é”®ä½œç”¨ï¼š

### 1. è§£å†³â€œå¯¼å…¥è·¯å¾„é—®é¢˜â€ï¼Œä¿è¯è·¨ç›®å½•è¿è¡Œå…¼å®¹æ€§
é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼ˆ`core/` å­˜æ ¸å¿ƒç»„ä»¶ã€`strategies/` å­˜ç­–ç•¥å®ç°ï¼‰ï¼Œä½†Pythoné»˜è®¤åªä¼šä»å½“å‰è¿è¡Œç›®å½•ã€ç³»ç»Ÿç¯å¢ƒå˜é‡ç­‰è·¯å¾„æœç´¢æ¨¡å—ã€‚
å¦‚æœè„šæœ¬åœ¨é¡¹ç›®å­ç›®å½•ï¼ˆå¦‚ `exercises/week1/`ï¼‰è¿è¡Œï¼Œç›´æ¥å¯¼å…¥ `core.context` æˆ– `strategies.double_ma` ä¼šå¤±è´¥ã€‚

å‡½æ•°é€šè¿‡ï¼š
- è®¡ç®—é¡¹ç›®æ ¹ç›®å½•ï¼ˆé€šè¿‡å¤šæ¬¡ `os.path.dirname` ä»å½“å‰è„šæœ¬è·¯å¾„å‘ä¸Šæ¨å¯¼ï¼‰ï¼›
- å°†æ ¹ç›®å½•æ·»åŠ åˆ° `sys.path`ï¼ˆPythonçš„æ¨¡å—æœç´¢è·¯å¾„ï¼‰ï¼›
ç¡®ä¿æ— è®ºåœ¨é¡¹ç›®å“ªä¸ªå­ç›®å½•è¿è¡Œè¯¥è„šæœ¬ï¼Œéƒ½èƒ½æ‰¾åˆ° `core/` å’Œ `strategies/` ä¸‹çš„æ¨¡å—ã€‚

### 2. æ‰¹é‡éªŒè¯å…³é”®æ¨¡å—/ç±»çš„å¯¼å…¥æœ‰æ•ˆæ€§
å‡½æ•°æ˜ç¡®æµ‹è¯•äº†é¡¹ç›®æœ€æ ¸å¿ƒçš„4ä¸ªæ¨¡å—+ç±»ç»„åˆï¼š
- `core.context.Context`ï¼šæ ¸å¿ƒä¸Šä¸‹æ–‡ç»„ä»¶ï¼ˆå¯èƒ½å­˜å‚¨å›æµ‹é…ç½®ã€æ•°æ®ç­‰ï¼‰ï¼›
- `core.engine.BacktestEngine`ï¼šå›æµ‹å¼•æ“ï¼ˆé¡¹ç›®æ ¸å¿ƒæ‰§è¡Œå…¥å£ï¼‰ï¼›
- `core.strategy.BaseStrategy`ï¼šç­–ç•¥åŸºç±»ï¼ˆæ‰€æœ‰è‡ªå®šä¹‰ç­–ç•¥çš„çˆ¶ç±»ï¼Œæ¨¡å—åŒ–è®¾è®¡çš„åŸºç¡€ï¼‰ï¼›
- `strategies.double_ma.DoubleMAStrategy`ï¼šå…·ä½“ç­–ç•¥å®ç°ï¼ˆéªŒè¯ç­–ç•¥æ¨¡å—ä¸æ ¸å¿ƒæ¨¡å—çš„ä¾èµ–è¿é€šæ€§ï¼‰ã€‚

è¿™äº›æ˜¯é¡¹ç›®è¿è¡Œçš„â€œåŸºç¡€éª¨æ¶â€ï¼Œåªè¦å®ƒä»¬èƒ½æ­£å¸¸å¯¼å…¥ï¼Œå°±è¯´æ˜æ¨¡å—åŒ–è®¾è®¡çš„ä¾èµ–å…³ç³»ã€æ–‡ä»¶ç»“æ„æ²¡æœ‰é—®é¢˜ã€‚

### 3. å¿«é€Ÿå®šä½å¯¼å…¥é”™è¯¯ï¼Œé™ä½åç»­å¼€å‘é£é™©
å¦‚æœå¯¼å…¥å¤±è´¥ï¼ˆå¦‚æ–‡ä»¶ç¼ºå¤±ã€æ¨¡å—åå†™é”™ã€ä¾èµ–ç¼ºå¤±ï¼‰ï¼Œå‡½æ•°ä¼šæ˜ç¡®è¾“å‡ºå¤±è´¥çš„æ¨¡å—+ç±»åå’Œé”™è¯¯åŸå› ï¼ˆæ¯”å¦‚ `ModuleNotFoundError`ã€`AttributeError`ï¼‰ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿæ’æŸ¥é—®é¢˜ï¼š
- è‹¥ `core.context.Context` å¤±è´¥ï¼šå¯èƒ½æ˜¯ `core/context.py` ä¸å­˜åœ¨ï¼Œæˆ–æ–‡ä»¶ä¸­æ²¡æœ‰å®šä¹‰ `Context` ç±»ï¼›
- è‹¥ `strategies.double_ma.DoubleMAStrategy` å¤±è´¥ï¼šå¯èƒ½æ˜¯ç­–ç•¥æ–‡ä»¶ç¼ºå¤±ï¼Œæˆ–æœªæ­£ç¡®ç»§æ‰¿ `BaseStrategy` å¯¼è‡´ç±»å®šä¹‰å¼‚å¸¸ã€‚

### æ€»ç»“
è¿™ä¸ªå‡½æ•°æ˜¯é¡¹ç›®çš„â€œåŸºç¡€ä¾èµ–æ£€æŸ¥å·¥å…·â€â€”â€”é€šè¿‡ç»Ÿä¸€å¯¼å…¥è·¯å¾„ã€æ‰¹é‡éªŒè¯æ ¸å¿ƒæ¨¡å—ï¼Œç¡®ä¿é¡¹ç›®çš„æ¨¡å—åŒ–è®¾è®¡èƒ½æ­£å¸¸å·¥ä½œï¼Œé¿å…åç»­å¼€å‘ï¼ˆå¦‚ç¼–å†™å›æµ‹é€»è¾‘ã€æ‰©å±•ç­–ç•¥ï¼‰æ—¶å› â€œå¯¼å…¥å¤±è´¥â€æµªè´¹æ—¶é—´ï¼Œæœ¬è´¨æ˜¯ä¸ºé¡¹ç›®çš„ç¨³å®šæ€§å’Œå¯å¼€å‘æ€§åšå‰ç½®éªŒè¯ã€‚
"""

def exercise_3_test_project_import():
    """
    ç»ƒä¹ 3: æµ‹è¯•é¡¹ç›®æ ¸å¿ƒæ¨¡å—æ˜¯å¦å¯ä»¥æ­£å¸¸å¯¼å…¥
    
    çŸ¥è¯†ç‚¹:
    - é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡
    - core/ åŒ…å«æ ¸å¿ƒç»„ä»¶
    - strategies/ åŒ…å«ç­–ç•¥å®ç°

    """
    print("\n" + "=" * 50)
    print("ç»ƒä¹ 3: æµ‹è¯•é¡¹ç›®æ¨¡å—å¯¼å…¥")
    print("=" * 50)
    
    import os               # å¯¼å…¥osæ¨¡å—ï¼Œç”¨äºå¤„ç†è·¯å¾„ï¼Œ
                            # ä¾‹å¦‚ï¼šè·å–å½“å‰æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€æ‹¼æ¥è·¯å¾„ç­‰
    
    # æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°è·¯å¾„ï¼Œä»¥ä¾¿å¯¼å…¥è‡ªå®šä¹‰æ¨¡å—ï¼Œ
    # ä¾‹å¦‚ï¼šå¦‚æœåœ¨strategies/ç›®å½•ä¸‹è¿è¡Œæ­¤è„šæœ¬ï¼Œ
    # åˆ™éœ€è¦æ·»åŠ ../core/åˆ°è·¯å¾„ï¼Œä»¥ä¾¿å¯¼å…¥context.pyç­‰æ¨¡å—

    # 1. å…ˆæ‰¾åˆ°é¡¹ç›®æ ¹ç›®å½•çš„è·¯å¾„
    # os.path.abspath(__file__) â†’ æ‹¿åˆ°å½“å‰è„šæœ¬çš„ç»å¯¹è·¯å¾„ï¼ˆæ¯”å¦‚ /xxx/Q_System/exercises/week1/day1_env_check.pyï¼‰
    # è¿ç»­ä¸‰æ¬¡ os.path.dirname() â†’ æ¯æ¬¡å¾€ä¸Šè·³ä¸€çº§ç›®å½•ï¼Œæœ€ç»ˆæ‹¿åˆ°æ ¹ç›®å½• /xxx/Q_System/
    project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))     # è·å–é¡¹ç›®æ ¹ç›®å½•è·¯å¾„ï¼Œ
                                                                                                    # ä¾‹å¦‚ï¼š/path/to/Q_System/exercises/week1/day1_env_check.py -> /path/to/Q_System
                                                                                                    # å‚è€ƒæ–‡æ¡£: https://docs.python.org/3/library/os.path.html#os.path.abspath
                                                                                                    # os.path.abspath(__file__)ï¼šè·å–å½“å‰æ–‡ä»¶çš„ç»å¯¹è·¯å¾„
                                                                                                    # os.path.dirname(...)ï¼šè·å–ä¸Šçº§ç›®å½•è·¯å¾„
                                                                                                    # åµŒå¥—è°ƒç”¨ä¸‰æ¬¡dirnameï¼Œè·å–é¡¹ç›®æ ¹ç›®å½•è·¯å¾„
                                                                                                    # æ–¹ä¾¿å¯¼å…¥é¡¹ç›®æ¨¡å—

    # å°†é¡¹ç›®æ ¹ç›®å½•æ·»åŠ åˆ°sys.pathï¼Œ
    # ä»¥ä¾¿åœ¨è¿è¡Œæ—¶åŠ¨æ€å¯¼å…¥é¡¹ç›®æ¨¡å—ï¼Œ
    # ä¾‹å¦‚ï¼šå¦‚æœåœ¨strategies/ç›®å½•ä¸‹è¿è¡Œæ­¤è„šæœ¬ï¼Œ
    # åˆ™éœ€è¦æ·»åŠ ../core/åˆ°è·¯å¾„ï¼Œä»¥ä¾¿å¯¼å…¥context.pyç­‰æ¨¡å—

    # 2. æŠŠæ ¹ç›®å½•åŠ å…¥ sys.pathï¼ˆå…ˆåˆ¤æ–­æ˜¯å¦å·²å­˜åœ¨ï¼Œé¿å…é‡å¤åŠ ï¼‰
    # sys.path æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå­˜å‚¨ç€Pythonè§£é‡Šå™¨åœ¨å¯¼å…¥æ¨¡å—æ—¶æœç´¢çš„è·¯å¾„
    # å°†æ ¹ç›®å½•æ·»åŠ åˆ° sys.pathâ€ï¼Œæœ¬è´¨æ˜¯ å‘Šè¯‰ Pythonï¼šâ€œæˆ‘çš„é¡¹ç›®æ ¸å¿ƒæ¨¡å—ï¼ˆcore/ã€strategies/ï¼‰åœ¨è¿™ä¸ªæ ¹ç›®å½•ä¸‹ï¼Œä½ å¯¼å…¥çš„æ—¶å€™è®°å¾—å»è¿™é‡Œæ‰¾ï¼Œä»è€Œè§£å†³è·¨ç›®å½•å¯¼å…¥æ¨¡å—å¤±è´¥çš„é—®é¢˜ã€‚
    if project_root not in sys.path:                                                                # æ£€æŸ¥é¡¹ç›®æ ¹ç›®å½•æ˜¯å¦å·²åœ¨sys.pathä¸­ï¼Œ
                                                                                                    # é¿å…é‡å¤æ·»åŠ 
        sys.path.insert(0, project_root)                                                            # æ’åœ¨åˆ—è¡¨ç¬¬0ä½ï¼Œè®©Pythonä¼˜å…ˆæŸ¥æ ¹ç›®å½•ï¼ˆé¿å…å’Œå…¶ä»–è·¯å¾„å†²çªï¼‰
                                                                                                    # å°†é¡¹ç›®æ ¹ç›®å½•æ·»åŠ åˆ°sys.pathçš„å¼€å¤´ï¼Œä»¥ç¡®ä¿ä¼˜å…ˆæœç´¢é¡¹ç›®æ¨¡å—
    
    # éœ€è¦æµ‹è¯•å¯¼å…¥çš„æ¨¡å—åˆ—è¡¨
    modules_to_test = [                                                                             # å®šä¹‰éœ€è¦æµ‹è¯•å¯¼å…¥çš„æ¨¡å—åˆ—è¡¨ï¼Œ
        ('core.context', 'Context'),                                                                # æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å«æ¨¡å—åå’Œç±»å
        ('core.engine', 'BacktestEngine'),
        ('core.strategy', 'BaseStrategy'),
        ('strategies.double_ma', 'DoubleMAStrategy'),
    ]
    
    all_ok = True                                                                                    # æ ‡è®°æ‰€æœ‰å¯¼å…¥æ˜¯å¦æˆåŠŸ

    # 3. æ‰¹é‡æµ‹è¯•å¯¼å…¥æ¨¡å—
    print("\næµ‹è¯•é¡¹ç›®æ ¸å¿ƒæ¨¡å—å¯¼å…¥:")

    for module_name, class_name in modules_to_test:                                                  # éå†éœ€è¦æµ‹è¯•çš„æ¨¡å—åˆ—è¡¨
        # æ‰“å°æ­£åœ¨æµ‹è¯•çš„æ¨¡å—ä¿¡æ¯
        print(f"æµ‹è¯•æ¨¡å—: {module_name}.{class_name}")

        try:                                                                                         # å°è¯•å¯¼å…¥æ¨¡å—å’Œç±»
            module = __import__(module_name, fromlist=[class_name])                                  # åŠ¨æ€å¯¼å…¥æ¨¡å—
            cls = getattr(module, class_name)                                                        # è·å–ç±»å¯¹è±¡  
            print(f"âœ“ {module_name}.{class_name}")                                                   # å¯¼å…¥æˆåŠŸ
        except Exception as e:                                                                       # æ•è·å¯¼å…¥å¼‚å¸¸
            print(f"âœ— {module_name}.{class_name} - {e}")                                             # å¯¼å…¥å¤±è´¥ï¼Œæ‰“å°å¼‚å¸¸ä¿¡æ¯
            all_ok = False                                                                           # æ ‡è®°å¯¼å…¥å¤±è´¥
    
    return all_ok


# === éªŒæ”¶æ£€æŸ¥ ===
def verify():
    """è¿è¡Œæ‰€æœ‰éªŒæ”¶æ£€æŸ¥"""
    print("\n" + "=" * 50)
    print("Day 1 ç¯å¢ƒéªŒè¯ - å¼€å§‹")
    print("=" * 50)
    
    results = {
        'Pythonç‰ˆæœ¬': exercise_1_check_python_version(),     # è¿è¡Œç»ƒä¹ 1ï¼Œæ£€æŸ¥Pythonç‰ˆæœ¬
        'xtquantå¯¼å…¥': exercise_2_test_xtquant_import(),     # è¿è¡Œç»ƒä¹ 2ï¼Œæµ‹è¯•xtquantå¯¼å…¥
        'é¡¹ç›®æ¨¡å—å¯¼å…¥': exercise_3_test_project_import(),    # è¿è¡Œç»ƒä¹ 3ï¼Œæµ‹è¯•é¡¹ç›®æ¨¡å—å¯¼å…¥
    }
    
    print("\n" + "=" * 50)
    print("éªŒæ”¶ç»“æœæ±‡æ€»")
    print("=" * 50)
    
    all_passed = True

    # è¾“å‡ºæ¯é¡¹æ£€æŸ¥ç»“æœï¼Œ
    # å¹¶æ ¹æ®ç»“æœåˆ¤æ–­æ˜¯å¦å…¨éƒ¨é€šè¿‡
    for name, passed in results.items():
        status = "âœ“ PASS" if passed else "âœ— FAIL"
        print(f"  {status} - {name}")
        if not passed:
            all_passed = False
    
    print("\n" + "=" * 50)
    if all_passed:
        print("ğŸ‰ Day 1 ç¯å¢ƒéªŒè¯å…¨éƒ¨é€šè¿‡ï¼")
        print("   å¯ä»¥ç»§ç»­ Day 2 çš„å­¦ä¹ äº†")
    else:
        print("âš  å­˜åœ¨æœªé€šè¿‡çš„æ£€æŸ¥é¡¹ï¼Œè¯·æ ¹æ®æç¤ºä¿®å¤")
    print("=" * 50)
    
    return all_passed


if __name__ == '__main__':
    verify()

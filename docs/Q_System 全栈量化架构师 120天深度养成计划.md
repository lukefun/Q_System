# docs\Q_System 全栈量化架构师 120天深度养成计划.md

## **总览**

* **目标**：独立构建一套集"数据清洗、回测验证、实盘交易、风控监控"于一体的 Python 量化系统。
* **核心哲学**：工程先行（搭建骨架），理论填充（注入灵魂），实战硬化（打磨血肉）。
* **时间预算**：120天（全职），每天有效学习时间 6-8 小时。

---

## **第一阶段：基础设施与金融扫盲 (Day 1 - Day 30)**

**阶段目标**：掌握 Python 数据处理，建立基础金融认知，跑通最小交易闭环。

### **Week 1: 环境搭建与 Python 工程化规范**

* **Day 1: 绝对环境配置**
  * **任务**：重装纯净的 Python 3.8 环境，配置 MiniQMT，配置 IDE (VSCode/PyCharm)。
  * **产出**：`check_env.py` 脚本全绿通过。
* **Day 2: Python 核心语法特训 (为量化定制)**
  * **重点**：列表推导式、字典操作 (`dict.get`)、异常处理 (`try-except-finally`)、装饰器基础。
* **Day 3: Pandas 数据清洗 (Series/DataFrame)**
  * **重点**：索引操作 (`loc/iloc`)、缺失值处理 (`fillna/dropna`)、数据合并 (`merge/concat`)。
* **Day 4: Pandas 进阶 (时间序列)**
  * **重点**：`resample` (K线周期转换)、`rolling` (移动平均)、`shift/diff` (涨跌计算)。
* **Day 5: 项目结构设计**
  * **任务**：建立标准的工程目录 (`core`, `data`, `strategies`, `logs`, `config`)。理解 `__init__.py` 的作用。
* **Day 6: Git 版本控制**
  * **任务**：学习 `git init`, `commit`, `branch`, `revert`。**代码必须要备份**。
* **Day 7: 周复盘与代码重构**
  * **动作**：清理本周写的零散脚本，整理成函数库。

### **Week 2: 金融数据工程 (XtData)**

* **Day 8: XtData 基础接口**
  * **任务**：掌握 `download_history_data` 和 `get_market_data`。对比 `tick` 数据与 `1d` 数据的区别。
* **Day 9: 复权与除权除息 (量化知识补课)**
  * **理论**：什么是前复权、后复权？为什么回测必须用前复权？
  * **实战**：对比不复权和前复权的 K 线图差异。
* **Day 10: 财务数据 ETL**
  * **任务**：获取 PE, PB, ROE 数据。处理财务数据发布日期的"滞后性"问题（避免未来函数）。
* **Day 11: 板块与行业数据**
  * **任务**：获取申万行业分类，构建"行业-股票"映射字典。
* **Day 12: 数据持久化 (HDF5/CSV)**
  * **任务**：编写 `DataManager` 类，实现"增量更新"：只下载本地没有的最新数据。
* **Day 13: 简单的可视化**
  * **任务**：使用 `Matplotlib` 画出带有均线、成交量的 K 线图。
* **Day 14: 周复盘**：构建一个本地的"全市场日线数据库"。

### **Week 3: 金融市场微观结构 (量化扫盲)**

* **Day 15: 订单与成交**
  * **理论**：限价单 vs 市价单。什么是 Order Book (订单簿)？什么是五档行情？
* **Day 16: 交易成本分析**
  * **理论**：佣金、印花税、过户费。**滑点 (Slippage)** 的成因与估算。
* **Day 17: 涨跌停与熔断机制**
  * **理论**：A股的涨跌停规则（主板10%，科创/创业20%，ST 5%）。如何在代码中识别停牌股？
* **Day 18: 回测中的"陷阱"**
  * **理论**：未来函数、幸存者偏差、偷价（用开盘价成交还是收盘价成交？）。
* **Day 19-20: 手算技术指标**
  * **任务**：不用库，纯手工用 Pandas 计算 MACD, KDJ, RSI。理解数学公式背后的市场含义。
* **Day 21: 周复盘**：写一篇《A股交易规则与量化避坑指南》。

### **Week 4: 最小可行性系统 (MVP)**

* **Day 22: 策略基类 (BaseStrategy) 设计**
  * **架构**：定义 `initialize` 和 `handle_bar` 接口。使用 `abc` 模块强制约束。
* **Day 23: 上下文对象 (Context) 设计**
  * **架构**：设计 `Context` 类，承载资金、持仓、时间游标。
* **Day 24: 简易回测循环**
  * **任务**：编写一个 `for` 循环，遍历时间轴，调用策略。
* **Day 25: 信号触发与记录**
  * **任务**：实现双均线策略，当金叉时打印"买入"，死叉时打印"卖出"。
* **Day 26-27: 第一次全流程联调**
  * **任务**：下载数据 -> 运行策略 -> 打印交易日志。
* **Day 28-30: 阶段一总结与休整**。

---

## **第二阶段：核心架构与回测引擎 (Day 31 - Day 60)**

**阶段目标**：实现一个高度仿真的回测引擎，支持资金结算、费用扣除。

### **Week 5: 账户与撮合系统 (The Core)**

* **Day 31: Portfolio (账户) 对象**
  * **任务**：设计 `Portfolio` 类，包含 `total_cash`, `frozen_cash`, `market_value`。
* **Day 32: Position (持仓) 对象**
  * **任务**：设计 `Position` 类，包含 `avg_price` (持仓均价), `volume` (持仓量)。
* **Day 33: 模拟撮合器 (Matcher) - 买入**
  * **逻辑**：检查资金是否足够？计算手续费。扣除现金，增加持仓。
* **Day 34: 模拟撮合器 (Matcher) - 卖出**
  * **逻辑**：检查持仓是否足够？(T+1规则)。扣除印花税。增加现金，减少持仓。
* **Day 35: 订单对象 (Order)**
  * **任务**：标准化 `Order` 对象，包含 `order_id`, `status` (已报/已成/废单)。
* **Day 36-37: 集成测试**
  * **任务**：手动模拟几笔交易，验证资金计算是否精确到小数点后2位。

### **Week 6: 回测引擎完善**

* **Day 38: 时间驱动机制**
  * **任务**：完善 `BacktestEngine`。每日盘前处理 (分红派息处理)，盘后结算 (计算当日净值)。
* **Day 39: 基准收益 (Benchmark)**
  * **任务**：引入沪深300指数作为对比基准。
* **Day 40: 撮合逻辑增强**
  * **任务**：加入**滑点模拟**（成交价浮动 0.1%）和**成交量限制**（不能超过当日该股票总成交量的 10%）。
* **Day 41-42: 绩效分析模块 (Analyzer)**
  * **任务**：计算 年化收益、最大回撤、夏普比率、胜率、盈亏比。
* **Day 43-44: 绘图模块**
  * **任务**：绘制 "策略净值 vs 基准净值" 曲线图，以及"每日持仓仓位"图。

### **Week 7: 策略开发实战 (经典策略)**

* **Day 45: 网格交易策略 (Grid Trading)**
  * **逻辑**：震荡市策略。跌买涨卖。
* **Day 46: 动量策略 (Momentum)**
  * **逻辑**：追涨杀跌。买入过去20天涨幅最高的股票。
* **Day 47: 均值回归策略 (Mean Reversion)**
  * **逻辑**：布林带策略。股价触碰下轨买入，触碰上轨卖出。
* **Day 48-49: 策略回测与对比**
  * **任务**：对比上述策略在 2020-2023 年的表现。
* **Day 50-51: 调试与优化**
  * **重点**：学会使用 Python Debugger (pdb) 或 IDE 断点调试复杂逻辑。

### **Week 8: 代码质量提升**

* **Day 52: 单元测试 (PyTest)**
  * **任务**：为 `Portfolio` 的资金计算逻辑编写测试用例。
* **Day 53: 类型注解 (Type Hinting)**
  * **任务**：给所有核心函数加上 `->` 类型提示，增强代码可读性。
* **Day 54: 异常处理强化**
  * **任务**：防止数据缺失导致回测崩溃。
* **Day 55-60: 阶段二总结与重构**。

---

## **第三阶段：量化研究与多因子选股 (Day 61 - Day 90)**

**阶段目标**：深入理解 Alpha 因子，构建多因子选股模型。**补足量化理论短板。**

### **Week 9: 因子理论基础**

* **Day 61: 什么是因子？**
  * **理论**：CAPM 模型，Alpha 与 Beta 的分离。
* **Day 62: 因子分类**
  * **理论**：规模因子、价值因子、成长因子、情绪因子、动量因子。
* **Day 63: 单因子有效性检验 (IC/IR)**
  * **理论**：如何判断一个因子是否有效？IC (信息系数) 的计算。
* **Day 64: 因子分层回测 (Layering)**
  * **理论**：将股票按因子值分为5组，看多空收益差。
* **Day 65-67: 因子计算实战**
  * **任务**：编写代码计算：流通市值(Log), EP(市盈率倒数), RSI强弱指标。

### **Week 10: 因子处理工艺**

* **Day 68: 去极值 (Winsorize)**
  * **实战**：处理 3倍标准差之外的异常数据。
* **Day 69: 标准化 (Z-Score)**
  * **实战**：让不同量纲的因子可以相加。
* **Day 70: 中性化 (Neutralization)**
  * **实战**：剔除市值影响和行业影响（高级内容，理解概念即可）。
* **Day 71-74: Alphalens 工具库**
  * **任务**：集成 `Alphalens` 库，生成专业的因子分析报告。

### **Week 11: 评分模型与选股**

* **Day 75: 多因子打分法**
  * **逻辑**：`Score = w1*F1 + w2*F2 + ...`
* **Day 76: 股票池筛选**
  * **任务**：过滤 ST、停牌、上市不满60天的股票。
* **Day 77: 盘前选股器 (Pipeline)**
  * **任务**：实现 `before_trading_start` 逻辑，每日开盘前生成 `target_list`。
* **Day 78-81: 策略实现：低估值高成长轮动**
  * **策略**：每月调仓，持有"PE低且ROE高"的前30只股票。

### **Week 12: 策略优化与过拟合**

* **Day 82: 参数寻优 (Grid Search)**
  * **任务**：寻找最优的持仓数量 (10/30/50) 和 调仓周期。
* **Day 83: 警惕过拟合**
  * **理论**：为什么参数不是越精确越好？样本内 vs 样本外测试。
* **Day 84-90: 阶段三实战总结**
  * **产出**：一个经过历史回测验证的、年化收益为正的多因子选股策略。

---

## **第四阶段：实盘工程化与风控体系 (Day 91 - Day 120)**

* **阶段目标**：对接真实交易接口，建立风控，实现无人值守运行。

### **Week 13: 实盘引擎 (LiveRunner)**

* **Day 91: 异步交易接口**
  * **任务**：掌握 `order_stock_async` 和回调函数 `on_order_stock_async_response`。
* **Day 92: 订单状态机**
  * **任务**：处理"已报、部成、已成、废单"状态流转。
* **Day 93: 实盘资产同步**
  * **任务**：启动时从 MiniQMT 同步真实的资金和持仓到 `Context`。
* **Day 94: 心跳与重连**
  * **任务**：检测 MiniQMT 是否断线，并自动重连。
* **Day 95-97: 模拟盘联调**
  * **任务**：在盘中时间（9:30-11:30）运行实盘引擎，观察日志。

### **Week 14: 交易算法与风控 (Risk Manager)**

* **Day 98: 拆单算法 (TWAP)**
  * **逻辑**：如果要买1万股，拆成10笔，每隔5分钟买一笔（避免冲击市场）。
* **Day 99: 事前风控**
  * **任务**：资金合规检查、科创板权限检查、黑名单过滤。
* **Day 100: 自动止损风控**
  * **任务**：当个股亏损 > 8% 或 账户回撤 > 5% 时，触发熔断清仓。
* **Day 101-104: 异常处理系统**
  * **任务**：处理"下单超时"、"废单重发"、"数据源中断"等极端情况。

### **Week 15: 自动化与监控**

* **Day 105: 任务调度 (APScheduler)**
  * **任务**：定时任务——9:00启动数据，9:15选股，9:30开始交易，15:10收盘结算。
* **Day 106: 消息推送**
  * **任务**：集成钉钉/飞书机器人。交易成交、报错时推送到手机。
* **Day 107: 每日报表**
  * **任务**：收盘后生成 HTML 报表（今日盈亏、持仓变化），发送邮件。
* **Day 108-111: 72小时无人值守压力测试**
  * **任务**：模拟盘连续运行3天，不做人为干预。

### **Week 16: 最终验收与部署**

* **Day 112: 简易 GUI 监控面板 (Streamlit)**
  * **任务**：做一个网页后台，查看运行状态。
* **Day 113: 代码冻结与清理**
  * **任务**：删除调试代码，完善注释。
* **Day 114: 编写操作手册**
  * **任务**：文档化——怎么启动、怎么配置参数、出问题怎么救火。
* **Day 115-119: 实盘小资金试跑**
  * **任务**：投入一手资金，验证滑点和真实成交情况。
* **Day 120: 毕业典礼**
  * **里程碑**：您已拥有一套完整的量化交易系统。

---

### **执行守则**

1. **不跳过**：即使某天任务看起来很简单（如 Git），也要做。这是职业素养。
2. **不贪快**：量化知识薄弱是最大的雷。遇到不懂的金融名词（如“分级基金下折”），一定要停下来彻底搞懂，不要只管代码跑通。
3. **多复盘**：每天收盘后（15:00），花1小时看日志，思考“今天机器为什么这么做”。
4. **及时反馈**：如果遇到问题，要第一时间反馈给我。
5. **保持专注**：量化交易是一个长期项目，需要持续关注。
6. **保持耐心**：量化交易是一个复杂的系统，需要耐心调试。
7. **持续学习**：量化交易领域变化迅速，要保持学习的热情和动力。
8. **记录日志**：养成良好的记录习惯，记录每天的学习和调试过程。
9. **代码规范**：遵循 PEP8 规范，保持代码整洁。
10. **团队协作**：如果有机会，尝试与他人合作，共同开发量化系统。
11. **保持健康**：长时间编程容易疲劳，注意劳逸结合，保持身体健康。
12. **保持关注**：关注行业动态，新技术的出现。
13. **保持学习**：量化交易是一个不断学习的领域，要保持学习的热情和动力。
